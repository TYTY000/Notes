好包：没有CRC错误、符号错误、序列错误、长度错误、对齐错误和载波扩展错误、接收错误。
网卡中的接收描述符会在接收序列空、host写存中有的时候去fetch，会在接收序列快空、host写存中有足够内容的描述符时去pre-fetch。
![[Pasted image 20230724083917.png]]
网卡的处理器的缓存行大小比接收描述符（16字节）大，所以写回接收的包会expensive，所以在以下两种情况时会实施部分写：
接收到打包的描述符（软件强制flush、未写包达到阈值、接收计时器归零）；
空地址的空描述符；

如果packet timer 超时了还没有新包，就会产生接收时钟中断。
如果packet timer被设置为0 ，host mem写一个包就会产生接收时钟中断
![[Pasted image 20230723224908.png]]
接收FIFO队列溢出代表着：
1.软件没有更新tail指针
2.PCI总线速度不足以处理所收FIFO队列。
此时所收到的包都会被丢弃。

发送描述符：
指向芯片上的寄存器上下文，原子装卸载，用于控制校验和卸载。
上下文描述符不应出现在包中央。
传统和普通的包的数据描述符只能在包层级有交叉。
![[Pasted image 20230724083944.png]]
发送的pre-fetch 类似 接收，但是要确保缓存一致性。
写回发生的情况：
1.阈值设置为0 ，并且 描述符中的RS设置为可写回
2.发送中断延迟计时器满
3.阈值大于0，并且发送描述符积累到阈值

寄存器约定
网卡上的寄存器都是32位，也应该通过32位的双字使用，64位对齐，以下是例外：
 · PCI配置寄存器
 · IO空间寄存器是32位对齐
 · 寄存器对是两个32位的寄存器组合成64位的逻辑大小
 · 通过扩展ROM或者第二基本地址寄存器空间访问的闪存可以是字，双字和4字。
 · 预留位。不应该被设置为1，除非明确要求，任何对包含预留位的读取都会返回不定值。软件在读时应该忽略预留位。
 · 预留/未定义地址。没有被明确声明的寄存器都视为预留并且不应该被写入；写入此类地址会导致UB。除非明确要求与指定，不应读取此类地址。
 · 初值。大多数寄存器会在被编程前就硬件定义了初值。未定义的初值会以 undefined/unknown/X 来表示。为了特定行为的发生，有的初值需要被EEPROM配置或软件赋予，这些初值通常和特定的功能绑定。有的寄存器可能会引用被更高优先级操作覆盖的硬件默认值；等等。

寄存器只会按照32位的双字整读整写，忽略部分写。
对读后清空的寄存器的部分读会导致UB，不应部分读。
所有统计寄存器都被实现为32位，64位的必须将高位失效。
地址不在64位上的32位寄存器不能通过64位访问进行访问